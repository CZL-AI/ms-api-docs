# 多宠物识别接口说明文档

## 1. 概述

在调用接口时，请确保携带以下必要参数：

* **`[TOKEN]`：设备密钥（必填）**
  可通过以下任一方式携带：

  1. 在请求头中添加 `Authorization: Bearer [TOKEN]`
  2. 作为请求参数：`?token=[TOKEN]`

* **`[HOST]`：服务宿主机地址**

* **`[PORT]`：服务端口号，默认为 `6057`**

---

## 2. 创建设备许可证密钥

### 接口说明：
用于根据设备 ID 创建一个指定过期时间的设备许可证密钥。

### 请求方式：
```
POST
```

### 请求地址：
```
https://license.chongzhiling.com/v1/license/secret/create
```

### 请求头：
| 参数名          | 类型     | 说明             |
| -------------- | ------ | -------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：
| 参数名         | 类型     | 说明           |
| ------------- | ------ | ------------ |
| `device_id`   | string | 设备唯一标识     |
| `expires_at`  | string | 许可证过期时间，格式为 `"YYYY-MM-DD HH:MM:SS"` |

示例请求体：
```json
{
  "device_id": "1111",
  "expires_at": "2025-09-09 00:00:00"
}
```

### 返回示例：
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "secret_key": "abcd1234-5678-efgh-90ij"
    }
}
```

### 返回参数说明：
| 参数名       | 类型     | 说明               |
| ----------- | ------ | ---------------- |
| `code`      | int    | 响应状态码，200 表示成功 |
| `message`   | string | 响应描述             |
| `data`      | object | 包含返回数据的对象      |
| └─`secret_key` | string | 生成的许可证密钥       |

--- 


## 3. 获取家庭用户列表

### 接口说明：
用于获取当前系统中的家庭用户列表，支持分页查询。

### 请求方式：
```
GET
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/user/list?page=1&limit=100
```

### 请求参数（Query Parameters）：

| 参数名   | 类型   | 说明                          |
| -------- | ------ | --------------------------- |
| `page`   | int    | 当前页码，默认值为 `1`          |
| `limit`  | int    | 每页显示数量，默认值为 `100`     |

> 注：可通过修改这两个参数实现分页加载。

### 返回示例：
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "username": "幸福一家人",
            "avatar": "111",
            "id": 63,
            "created_at": "2025-06-25 06:28:02"
        }
    ]
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | -------- | ------------------------ |
| `code`      | int      | 响应状态码，200 表示成功     |
| `message`   | string   | 响应描述                   |
| `data`      | array    | 用户信息数组，每个元素包含以下字段： |
| └─`username` | string  | 家庭用户名                  |
| └─`avatar`   | string  | 用户头像标识                |
| └─`id`       | int     | 用户唯一标识 ID             |
| └─`created_at` | string | 用户创建时间，格式为 `"YYYY-MM-DD HH:MM:SS"` |

--- 


## 4. 新增家庭用户

### 接口说明：
用于创建一个新的家庭用户。

### 请求方式：
```
POST
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/user/add
```

### 请求头：
| 参数名          | 类型     | 说明             |
| -------------- | ------ | -------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：
| 参数名      | 类型     | 说明        |
| ---------- | ------ | --------- |
| `username` | string | 用户名称     |
| `avatar`   | string | 用户头像标识  |

示例请求体：
```json
{
  "username": "幸福一家人",
  "avatar": "111"
}
```

### 返回示例：
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "username": "幸福一家人",
        "avatar": "111",
        "id": 63,
        "created_at": "2025-06-25 06:28:02"
    }
}
```

### 返回参数说明：
| 参数名       | 类型     | 说明               |
| ----------- | ------ | ---------------- |
| `code`      | int    | 响应状态码，200 表示成功 |
| `message`   | string | 响应描述             |
| `data`      | object | 包含新增用户数据的对象   |
| └─`username` | string | 新增用户的用户名       |
| └─`avatar`   | string | 新增用户的头像标识      |
| └─`id`       | int    | 新增用户的唯一标识 ID   |
| └─`created_at` | string | 用户创建时间，格式为 `"YYYY-MM-DD HH:MM:SS"` |

## 6. 更新家庭用户信息

### 接口说明：
用于更新指定 ID 的家庭用户信息，包括用户名和头像标识。

### 请求方式：
```
PUT
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/user/[用户ID]
```

### 请求头：
| 参数名          | 类型     | 说明                   |
| -------------- | ------ | -------------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：
| 参数名      | 类型     | 说明        |
| ---------- | ------ | --------- |
| `username` | string | 用户名称     |
| `avatar`   | string | 用户头像标识  |

示例请求体：
```json
{
  "username": "幸福一家",
  "avatar": "111"
}
```

### 返回示例：
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "username": "幸福一家",
        "avatar": "111",
        "id": 1,
        "created_at": "2025-06-25 03:04:15"
    }
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | ------ | ------------------------ |
| `code`      | int    | 响应状态码，200 表示成功         |
| `message`   | string | 响应描述                     |
| `data`      | object | 包含更新后的用户数据对象         |
| └─`username` | string | 更新后的用户名                |
| └─`avatar`   | string | 用户头像标识                  |
| └─`id`       | int    | 用户唯一标识 ID               |
| └─`created_at` | string | 用户创建时间，格式为 `"YYYY-MM-DD HH:MM:SS"` |


## 6. 删除家庭用户

### 接口说明：
用于根据用户 ID 批量删除家庭用户。

### 请求方式：
```
DELETE
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/user/del
```

### 请求头：
| 参数名          | 类型     | 说明                   |
| -------------- | ------ | -------------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：
| 参数名    | 类型      | 说明           |
| -------- | -------  | ------------ |
| `ids`    | array    | 要删除的家庭用户 ID 列表 |

示例请求体：
```json
[1, 2, 3]
```

### 返回示例：
```json
{
    "code": 200,
    "message": "success",
    "data": "删除成功"
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | ------ | ------------------------ |
| `code`      | int    | 响应状态码，200 表示成功         |
| `message`   | string | 响应描述                     |
| `data`      | string | 操作结果描述，例如 `"删除成功"` |


## 7. 添加宠物档案

### 接口说明：
用于通过上传图片或视频为新宠物创建档案。

根据 `is_img` 参数判断上传的是图片还是视频：

- 若为 `true`：支持多张图片上传。
- 若为 `false`：视为视频上传，仅取第一个文件进行处理。

### 请求方式：
```
POST
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/profile/add
```

### 请求头：
| 参数名          | 类型     | 说明                   |
| -------------- | ------ | -------------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：

| 参数名    | 类型      | 说明                         |
| --------- | -------  | -------------------------- |
| `is_img`  | boolean  | 是否为图片上传，`true` 表示图片，`false` 表示视频 |
| `name`    | string   | 宠物名称                     |
| `user_id` | int      | 所属家庭用户的 ID              |
| `urls`    | array    | 图片或视频的 URL 列表           |

示例请求体：
```json
{
    "is_img": false,
    "name": "花花",
    "user_id": 1,
    "urls": [
        "https://czl-upload.oss-cn-shenzhen.aliyuncs.com/1112/20250221/1750433756.mp4?x-oss-credential=LTAI5tC5zY6BMLFtRpeyStcc%2F20250625%2Fcn-shenzhen%2Foss%2Faliyun_v4_request&x-oss-date=20250625T025154Z&x-oss-expires=3600&x-oss-signature-version=OSS4-HMAC-SHA256&x-oss-signature=77c29de425bc74ae92d6966a4aff6b9de78c07e69f75c129aa836abbb80bd34a"
    ]
}
```

### 响应示例：
```json
{
    "code": 200,
    "message": "索引构建成功",
    "data": {
        "user_id": "1",
        "name": "花花",
        "avatar": "1750841789_000000.jpg",
        "pet_id": 1,
    }
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | ------ | ------------------------ |
| `code`      | int    | 响应状态码，200 表示成功         |
| `message`   | string | 响应描述                     |
| `data`      | object | 包含操作结果数据的对象           |
| └─`user_id`  | string | 宠物所属家庭用户的 ID             |
| └─`name`     | string | 宠物名称                      |
| └─`avatar`   | string | 宠物头像文件名（可通过指定地址访问） |
| └─`pet_id`   | int | 宠物档案ID |
 
> 示例头像访问地址：  
> `http://[HOST]:[PORT]/media/img/1750841789_frame_000000.jpg`

---

# 8. 修改宠物档案

### 接口说明：
用于通过上传图片或视频更新已有宠物档案信息。根据 `is_img` 参数判断上传的是图片还是视频：

- 若为 `true`：支持多张图片上传。
- 若为 `false`：视为视频上传，仅取第一个文件进行处理。

### 请求方式：
```
PUT
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/profile/[宠物ID]?token=[TOKEN]
```

> 注：`token` 可通过请求头 `Authorization: Bearer [TOKEN]` 或 URL 参数方式携带。

### 请求头：
| 参数名          | 类型     | 说明                   |
| -------------- | ------ | -------------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：

| 参数名    | 类型      | 说明                         |
| --------- | -------  | -------------------------- |
| `is_img`  | boolean  | 是否为图片上传，`true` 表示图片，`false` 表示视频 |
| `name`    | string   | 宠物名称                     |
| `urls`    | array    | 图片或视频的 URL 列表           |

示例请求体：
```json
{
    "is_img": true,
    "name": "花花493",
    "urls": [
        "https://czl-upload.oss-cn-shenzhen.aliyuncs.com/1112/20250220/1745481509sulQBEPY.jpg",
        "https://czl-upload.oss-cn-shenzhen.aliyuncs.com/1112/20250220/1745481509sulQBEPY.jpg",
        "https://czl-upload.oss-cn-shenzhen.aliyuncs.com/1112/20250220/1745481509sulQBEPY.jpg"
    ]
}
```

### 响应示例：
```json
{
    "code": 200,
    "message": "档案更新成功",
    "data": {
        "user_id": "169",
        "name": "花花493",
        "avatar": "1751550434_000.jpg",
        "pet_id": 2
    }
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | ------ | ------------------------ |
| `code`      | int    | 响应状态码，200 表示成功         |
| `message`   | string | 响应描述                     |
| `data`      | object | 包含操作结果数据的对象           |
| └─`user_id`  | string | 宠物所属家庭用户的 ID             |
| └─`name`     | string | 宠物名称                      |
| └─`avatar`   | string | 宠物头像文件名（可通过指定地址访问） |
| └─`pet_id`   | int    | 宠物档案 ID                    |

> 示例头像访问地址：  
> `http://[HOST]:[PORT]/media/img/1751550434_000.jpg`


## 9. 宠物识别接口

### 接口说明：
用于通过上传图片或视频识别宠物身份，需指定家庭用户 ID 及文件 URL。

### 请求方式：
```
POST
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/recog/identify?token=[TOKEN]
```

> 注：`token` 可通过请求头 `Authorization: Bearer [TOKEN]` 或 URL 参数方式携带。

### 请求头：
| 参数名          | 类型     | 说明                   |
| -------------- | ------ | -------------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：

| 参数名    | 类型   | 说明                 |
| --------- | ------ | ------------------ |
| `user_id` | int    | **必填**，所属家庭用户的 ID |
| `url`     | string | **必填**，图片或视频的 URL 地址 |

示例请求体：
```json
{
    "user_id": 1,
    "url": "https://czl-upload.oss-cn-shenzhen.aliyuncs.com/1112/20250221/1750433756.mp4"
}
```

### 响应示例：
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "name": "花花",
            "user_id": 1,
            "pet_id": 1
        }
    ]
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | ------ | ------------------------ |
| `code`      | int    | 响应状态码，200 表示成功         |
| `message`   | string | 响应描述                     |
| `data`      | array  | 包含识别结果的数据对象数组         |
| └─`name`     | string | 识别出的宠物名称               |
| └─`user_id`  | string | 所属家庭用户的 ID              |
| └─`pet_id`  | string | 宠物档案 ID              |

---

## 10. 检测视频或图片中是否有宠物

### 接口说明：
用于检测指定的图片或视频中是否包含宠物，返回布尔值结果。

### 请求方式：
```
POST
```

### 请求地址：
```
http://[HOST]:[PORT]/v1/recog/check_pet?token=[TOKEN]
```

> 注：`token` 可通过请求头 `Authorization: Bearer [TOKEN]` 或 URL 参数方式携带。

### 请求头：
| 参数名          | 类型     | 说明                   |
| -------------- | ------ | -------------------- |
| `Content-Type` | string | 固定值 `application/json` |

### 请求参数（JSON Body）：

| 参数名 | 类型   | 说明               |
| ------ | ------ | ---------------- |
| `url`  | string | **必填**，图片或视频的 URL 地址 |

示例请求体：
```json
{
    "url": "https://czl-upload.oss-cn-shenzhen.aliyuncs.com/1112/20250221/1750433756.mp4"
}
```

### 返回示例：
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "is_present": true
    }
}
```

### 返回参数说明：

| 参数名       | 类型     | 说明                       |
| ----------- | ------ | ------------------------ |
| `code`      | int    | 响应状态码，200 表示成功         |
| `message`   | string | 响应描述                     |
| `data`      | object | 包含检测结果的数据对象           |
| └─`is_present` | boolean | 指示是否检测到宠物，`true` 表示有宠物，`false` 表示无宠物 |

