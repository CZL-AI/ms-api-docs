# 多宠物识别接口说明文档

## 0. 概述

在调用接口时，请确保携带以下必要参数：

* **`[TOKEN]`：家庭用户令牌（必填）**
  可通过以下任一方式携带：

  1. 在请求头中添加 `Authorization: Bearer [TOKEN]`
  2. 作为请求参数：`?token=[TOKEN]`

* **`[HOST]`：服务宿主机地址**

* **`[PORT]`：服务端口号，默认为 `6057`**

---

## 1. 获取宠物档案列表

### 接口说明

获取当前家庭下的所有宠物档案信息。每个家庭最多可添加 6 个宠物。

### 请求方式

```
GET
```

### 请求地址

```
http://[HOST]:[PORT]/v1/profile/list?token=[TOKEN]
```

### 返回示例

```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "id": 2121,
            "name": "花花",
            "user_id": 1000079,
            "avatar": "1750251980_frame_0051.jpg"
        }
    ],
    "count": 1
}
```

### 返回参数说明

| 参数名       | 类型     | 说明             |
| --------- | ------ | -------------- |
| `code`    | int    | 响应状态码，200 表示成功 |
| `message` | string | 响应描述           |
| `data`    | array  | 宠物档案列表         |
| `id`      | int    | 宠物唯一标识         |
| `name`    | string | 宠物名称           |
| `user_id` | int    | 所属用户 ID        |
| `avatar`  | string | 宠物头像文件名        |
| `count`   | int    | 当前宠物总数         |

---

## 2. 添加宠物档案

### 接口说明

通过上传视频为新宠物创建档案。

### 请求方式

```
POST
```

### 请求地址

```
http://[HOST]:[PORT]/v1/profile/add?token=[TOKEN]
```

### 请求参数（`form-data`）

| 参数名     | 类型     | 说明     |
| ------- | ------ | ------ |
| `video` | file   | 建档视频文件 |
| `name`  | string | 宠物名称   |

### 返回示例

```json
{
    "code": 200,
    "message": "索引构建成功",
    "data": {
        "original_to_mapped": {
            "1750251980": "花花"
        },
        "feature_counts": 126,
        "body_feature_counts": 81,
        "warnings": [],
        "first_cat_frames": {
            "1750251980.mp4": {
                "frame_name": "frame_0051.jpg",
                "category": "花花",
                "frame_base64": "1750251980_frame_0051.jpg",
                "only_one_cat": true,
                "avatar_exist_cat": true,
                "avatar_exist": true,
                "confidence": 0.9185407161712646
            }
        },
        "avatar": "1750251980_frame_0051.jpg"
    }
}
```

### 返回参数说明

| 参数名                     | 类型      | 说明                 |
| ----------------------- | ------- | ------------------ |
| `code`                  | int     | 响应状态码，200 表示成功     |
| `message`               | string  | 响应描述               |
| `data`                  | object  | 识别结果详情             |
| └─`original_to_mapped`  | object  | 视频标识与宠物名的映射关系      |
| └─`feature_counts`      | int     | 提取的总特征数            |
| └─`body_feature_counts` | int     | 身体部位特征数            |
| └─`warnings`            | array   | 警告信息（如无则为空）        |
| └─`first_cat_frames`    | object  | 视频首帧识别详情           |
| └─`frame_name`          | string  | 首帧图像文件名            |
| └─`category`            | string  | 宠物名称               |
| └─`frame_base64`        | string  | 首帧图像对应的 Base64 文件名 |
| └─`only_one_cat`        | boolean | 是否仅检测到一只宠物         |
| └─`avatar_exist_cat`    | boolean | 是否有可作为头像的宠物        |
| └─`avatar_exist`        | boolean | 是否已存在头像            |
| └─`confidence`          | float   | 识别置信度              |
| `avatar`                | string  | 宠物头像文件名            |

---

## 3. 宠物识别接口

### 接口说明

通过上传视频识别宠物身份。

### 请求方式

```
POST
```

### 请求地址

```
http://[HOST]:[PORT]/v1/recog/identify?token=[TOKEN]
```

### 请求参数（`form-data`）

| 参数名     | 类型   | 说明        |
| ------- | ---- | --------- |
| `video` | file | 用于识别的视频文件 |

### 返回示例

```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "track_id": 0,
            "category": "花花",
            "probability": 0.99,
            "timestamp": "00:02",
            "box": [432, 280, 886, 795],
            "confirmation_level": 1,
            "image": "00_02_0_花花.jpg"
        }
    ]
}
```

### 返回参数说明

| 参数名                    | 类型     | 说明                      |
| ---------------------- | ------ | ----------------------- |
| `code`                 | int    | 响应状态码，200 表示成功          |
| `message`              | string | 响应描述                    |
| `data`                 | array  | 识别结果数组                  |
| └─`track_id`           | int    | 跟踪 ID，用于标识不同宠物          |
| └─`category`           | string | 识别出的宠物名称                |
| └─`probability`        | float  | 识别概率，越高表示越准确            |
| └─`timestamp`          | string | 识别发生的时间（视频时间点）          |
| └─`box`                | array  | 检测框坐标 \[x1, y1, x2, y2] |
| └─`confirmation_level` | int    | 系统对识别结果的确认等级            |
| └─`image`              | string | 识别时捕捉的宠物图像文件名           |

---

## 4. 删除宠物档案

### 接口说明

删除指定宠物的档案记录。

### 请求方式

```
POST
```

### 请求地址

```
http://[HOST]:[PORT]/v1/profile/del/[宠物ID]?token=[TOKEN]
```

### 返回示例

```json
{
    "code": 200,
    "message": "success",
    "data": "删除成功"
}
```

### 返回参数说明

| 参数名       | 类型     | 说明               |
| --------- | ------ | ---------------- |
| `code`    | int    | 响应状态码，200 表示成功   |
| `message` | string | 响应描述             |
| `data`    | string | 返回结果，例如 `"删除成功"` |